#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Sun Nov 14 07:35:04 2021

@author: rubylintu
"""

#import twstock
import re
import os, sys
import requests
from bs4 import BeautifulSoup

def read_stock_list(filename):
    #filename = "stock_list.txt"
    f = open(filename,'r')
    lines = f.readlines()
    dict_stock = {}
    for line in lines:
        mat = re.split(' |\t|\n',line);
        if len(mat)<=2:
            continue
        else:
            dict_stock[mat[2]] = mat[0]
    return dict_stock

def scrapeHiStockSamp(num): 
    url = 'https://histock.tw/stock/' + str(num)  
    response = requests.get(url)
    #print(response.text)
    root=BeautifulSoup(response.text, "html.parser")
    deal=root.find("span", class_="clr-rd")
    return url, root, deal
 

dict_stock = read_stock_list("stock_list.txt")
for key in dict_stock.keys():
    num = dict_stock[key]
    url, root, price = scrapeHiStockSamp(num)
    print(key, num, price)

#url = 'https://histock.tw/stock/warrantstats.aspx'
#dict_stock = read_stock_list('stock_list.txt')
#for stock in dict_stock.keys():
#    numstock = dict_stock[stock]
#    passstock = twstock.realtime.get(numstock)
#    print(str(passstock)+stock)

    
#def write_json(new_data, filename='data.json'):
#    with open(filename,'r+') as file:
#          # First we load existing data into a dict.
#        file_data = json.load(file)
#        # Join new_data with file_data inside emp_details
#        file_data["emp_details"].append(new_data)
#        # Sets file's current position at offset.
#        file.seek(0)
#        # convert back to json.
#        json.dump(file_data, file, indent = 4)
